<ng-container [ngTemplateOutlet]="{'import': import, 'export': export}[mode]">

</ng-container>

<ng-template #import>
    <ng-container *ngIf="(fileGameReader.fileProgressState$ | async) == 'finish'; else uploadFile">
        <tui-block-status>
            <h4>{{'file-loaded' | translate}}</h4>

            <button tuiButton appearance="secondary">
                {{'remove' | translate}}
            </button>
        </tui-block-status>
    </ng-container>
</ng-template>
<ng-template #uploadFile>
    <h3>{{'gamedata-file-description' | translate}}</h3>

    <tui-input-files *ngIf="!fileControl.value" class="file-upload-input" [formControl]="fileControl"
        [maxFileSize]="(1024*1024*100)" [multiple]="false" (reject)="onRejectFile($event)">
        <ng-template let-dragged>
            <div *ngIf="dragged; else base" class="content">
                <tui-marker-icon class="tui-space_right-1" mode="link" src="tuiIconDropletLarge"></tui-marker-icon>
                <div>{{'drop-obb' | translate}}</div>
            </div>
            <ng-template #base>
                <tui-marker-icon class="tui-space_right-1" mode="link" src="tuiIconUploadCloudLarge"></tui-marker-icon>
                <div>
                    {{'drag-gamedata' | translate}}
                    <a tuiLink>{{'click-to-upload' | translate}}</a>
                </div>
            </ng-template>
        </ng-template>
    </tui-input-files>

    <ng-container *ngIf="loadedFile$ | async as file">
        <tui-block-status>
            <h4 class="tui-space_bottom-3" style="display: flex; flex-direction: column;">
                <span>{{'status' | translate}}: {{((fileGameReader.fileProgressState$ | async) ?? '') | translate}}</span>
            </h4>
            <ng-container *ngIf="(fileGameReader.fileProgressBarMax$ | async) as max">
                <label *ngIf="(fileGameReader.fileProgressBar$ | async) as value" tuiProgressLabel>
                    <span class="text">{{'completed' | translate}}</span>
                    <span class="percent">{{ (value / max * 100) | number : '1.2-2' }}%</span>
                    <tui-progress-circle [value]="value" [max]="max" size="xl"></tui-progress-circle>
                </label>
            </ng-container>
        </tui-block-status>
    </ng-container>
</ng-template>

<ng-template #export>
    <ng-container *ngIf="(fileGameReader.fileExportProgressState$ | async) == 'finish'; else uploadExportFile">
        <tui-block-status>
            <h4>{{'process-complete' | translate}}</h4>

            <p>{{'gamedata-process-complete-0' | translate}}</p>
            <b>{{'gamedata-process-complete-1' | translate}}</b>
            <p>{{'gamedata-process-complete-2' | translate}}
                <a href="{{fileGameReader.url}}" download="{{fileGameReader.file?.name}}" type="File">{{'click-here' | translate}}</a>
            </p>
        </tui-block-status>
    </ng-container>
</ng-template>
<ng-template #uploadExportFile>
    <h3>{{'gamedata-file-description' | translate}}</h3>

    <tui-input-files *ngIf="!fileControl.value" class="file-upload-input" [formControl]="fileControl"
        [maxFileSize]="(1024*1024*100)" [multiple]="false" (reject)="onRejectFile($event)">
        <ng-template let-dragged>
            <div *ngIf="dragged; else base" class="content">
                <tui-marker-icon class="tui-space_right-1" mode="link" src="tuiIconDropletLarge"></tui-marker-icon>
                <div>{{'drop-obb' | translate}}</div>
            </div>
            <ng-template #base>
                <tui-marker-icon class="tui-space_right-1" mode="link" src="tuiIconUploadCloudLarge"></tui-marker-icon>
                <div>
                    {{'drag-gamedata' | translate}}
                    <a tuiLink>{{'click-to-upload' | translate}}</a>
                </div>
            </ng-template>
        </ng-template>
    </tui-input-files>

    <ng-container *ngIf="loadedFile$ | async as file">
        <tui-block-status>
            <h4 class="tui-space_bottom-3" style="display: flex; flex-direction: column;">
                <span>{{'status' | translate}}: {{((fileGameReader.fileProgressState$ | async) ?? '') | translate}}</span>
            </h4>
            <ng-container *ngIf="(fileGameReader.fileProgressBarMax$ | async) as max">
                <label *ngIf="(fileGameReader.fileProgressBar$ | async) as value" tuiProgressLabel>
                    <span class="text">{{'completed' | translate}}</span>
                    <span class="percent">{{ (value / max * 100) | number : '1.2-2' }}%</span>
                    <tui-progress-circle [value]="value" [max]="max" size="xl"></tui-progress-circle>
                </label>
            </ng-container>
        </tui-block-status>
    </ng-container>
</ng-template>
<div style="padding: 1em;">
    <div class="tui-space_top-3" style="display: flex; flex-direction: row-reverse;"
        *ngIf="languages && languages.length > 1">
        <tui-select style="width: 180px;" tuiTextfieldSize="m" [formControl]="language">
            Language
            <input tuiTextfield placeholder="..." />
            <tui-data-list-wrapper *tuiDataList [items]="languages">
            </tui-data-list-wrapper>
        </tui-select>
    </div>
    <ng-container *ngIf="(language.valueChanges | async)">
        <ng-container *ngIf="breakpointService$ | async as breakpoint">
            <ng-container *ngIf="(dialogAssets$ | async) as data; else loading;">
                <ng-container *ngIf="breakpoint === 'desktopLarge' || breakpoint === 'desktopSmall'">
                    <tui-tabs [(activeItemIndex)]="activeItemIndex" class="tui-space_bottom-2">
                        <button *ngFor="let item of data" tuiTab>
                            {{item.Number}}
                        </button>
                    </tui-tabs>
                    <ng-container *ngIf="data[activeItemIndex] as dialogAsset">
                        <table style="table-layout: fixed;" tuiTable [columns]="['OriginalText', 'Translation']"
                            [@popIn]>
                            <thead>
                                <tr tuiThGroup>
                                    <th tuiTh *tuiHead="'OriginalText'" [sticky]="true" [sorter]="null"
                                        style="width: 100%;">
                                        Original
                                    </th>
                                    <th tuiTh *tuiHead="'Translation'" [sticky]="true" [sorter]="null">
                                        Translation
                                        <tui-toggle class="tui-space_left-2" [showIcons]="true"
                                            [(ngModel)]="propagateTranslation"></tui-toggle>
                                        <tui-tooltip [content]="propagationTooltip" direction="right"
                                            [appearance]="'onDark'">
                                        </tui-tooltip>
                                    </th>
                                </tr>
                            </thead>
                            <tbody tuiTbody>
                                <tr *ngFor="let item of dialogAsset.Model['$content']" tuiTr>
                                    <td *tuiCell="'OriginalText'" tuiTd class="tooltip-name-cell">
                                        {{item.OriginalText}}
                                    </td>
                                    <td *tuiCell="'Translation'" tuiTd>
                                        <div [ngStyle]="{'zoom': breakpoint === 'desktopSmall' ? '0.9' : 1}">
                                            <div style="display: flex;">
                                                <img class="dialog-translation-background"
                                                    src="/assets/images/dialog_paper.png" alt="dialot_paper">
                                                <img class="dialog-translation-background"
                                                    style="transform: scaleX(-1);" src="/assets/images/dialog_paper.png"
                                                    alt="dialot_paper">
                                            </div>
                                            <div style="position: relative; left: -6px;">
                                                <img style="width: 128px; height: 128px; position: absolute; bottom: 24px; left: 24px;"
                                                    src="/assets/images/figure_base2.png" alt="base" loading="lazy">
                                                <img style="width: 128px; height: 128px; position: absolute; bottom: 24px; left: 24px;"
                                                    src="/assets/images/portraits/{{item.IconName}}"
                                                    onerror="this.onerror=null; this.src='/assets/images/portrait-miss.svg'"
                                                    alt="portrait not found" width="100" height="120" loading="lazy">
                                                <img style="width: 148px; height: 148px; position: absolute; bottom: 12px; left: 18px; opacity: 0.50;"
                                                    src="/assets/images/figure_frame.png" alt="base" loading="lazy">
                                            </div>
                                            <div style="position: absolute; top: 30px; left: 168px;">
                                                <input [(ngModel)]="item.SpeakerName"
                                                    (focus)="previousPropagationValue = item.SpeakerName"
                                                    (ngModelChange)="onSpeakerNameChange($event, data)"
                                                    class="dialog-speaker-name" />
                                            </div>
                                            <div style="position: absolute; top: 64px; left: 168px; max-width: 450px;">
                                                <textarea [(ngModel)]="item.Text" cols="4" class="dialog-translation">
                                                                </textarea>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </ng-container>
                </ng-container>
                <ng-container *ngIf="breakpoint === 'mobile'">
                    <div style="position: relative;">
                        <tui-tabs-with-more [itemsLimit]="1" [(activeItemIndex)]="activeItemIndex" [moreContent]="more">
                            <ng-container *ngFor="let item of data">
                                <button *tuiItem tuiTab>
                                    {{item.Number}}
                                </button>
                            </ng-container>
                            <ng-template #more>
                                <tui-svg src="tuiIconMoreHorizontalLarge"></tui-svg>
                            </ng-template>
                        </tui-tabs-with-more>
                        <div style="position: absolute; right: 0; bottom: 0;">
                            <button tuiIconButton type="button" appearance="icon" shape="square"
                                [tuiDropdown]="dropdownContent" [tuiDropdownManual]="openOption"
                                (click)="openOption = !openOption" icon="tuiIconMoreVerticalLarge"></button>
                            <ng-template #dropdownContent>
                                <div style="padding: 1em;">
                                    Propagation:
                                    <tui-toggle [showIcons]="true" [(ngModel)]="propagateTranslation"></tui-toggle>
                                    <tui-tooltip [content]="propagationTooltip" direction="right"
                                        [appearance]="'onDark'">
                                    </tui-tooltip>
                                </div>
                            </ng-template>
                        </div>
                    </div>
                    <div #container>
                        <tui-scrollbar>
                            <cdk-virtual-scroll-viewport tuiScrollable itemSize="5" class="viewport tui-zero-scrollbar">
                                <ng-container *cdkVirtualFor="let item of data[activeItemIndex].Model['$content']">
                                    <p class="tui-text_body-s">{{item.OriginalText}}</p>
                                    <div style="position: relative;"
                                        [ngStyle]="{'zoom': container.offsetWidth * 1.12 / 767}">
                                        <div style="display: flex;">
                                            <img class="dialog-translation-background"
                                                src="/assets/images/dialog_paper.png" alt="dialot_paper">
                                            <img class="dialog-translation-background" style="transform: scaleX(-1);"
                                                src="/assets/images/dialog_paper.png" alt="dialot_paper">
                                        </div>
                                        <div style="position: relative; left: -6px;">
                                            <img style="width: 128px; height: 128px; position: absolute; bottom: 24px; left: 24px;"
                                                src="/assets/images/figure_base2.png" alt="base" loading="lazy">
                                            <img style="width: 128px; height: 128px; position: absolute; bottom: 24px; left: 24px;"
                                                src="/assets/images/portraits/{{item.IconName}}"
                                                onerror="this.src='/assets/images/portrait-miss.svg';"
                                                alt="portrait not found" width="100" height="120" loading="lazy">
                                            <img style="width: 148px; height: 148px; position: absolute; bottom: 12px; left: 18px; opacity: 0.50;"
                                                src="/assets/images/figure_frame.png" alt="base" loading="lazy">
                                        </div>
                                        <div style="position: absolute; top: 30px; left: 168px;">
                                            <input [(ngModel)]="item.SpeakerName"
                                                (focus)="previousPropagationValue = item.SpeakerName"
                                                (ngModelChange)="onSpeakerNameChange($event, data)"
                                                class="dialog-speaker-name" />
                                        </div>
                                        <div style="position: absolute; top: 64px; left: 168px; max-width: 450px;">
                                            <textarea [(ngModel)]="item.Text" cols="4" class="dialog-translation">
                                                </textarea>
                                        </div>
                                    </div>
                                    <hr class="tui-space_top-2">
                                </ng-container>
                            </cdk-virtual-scroll-viewport>
                        </tui-scrollbar>
                    </div>
                </ng-container>
            </ng-container>
        </ng-container>
    </ng-container>
    <ng-template #loading>
        <tui-loader [showLoader]="true" [overlay]="true" [size]="'xxl'">
            <tui-block-status>
                <h4>...Loading...</h4>
            </tui-block-status>
        </tui-loader>
    </ng-template>
</div>

<ng-template #propagationTooltip>
    Propagation: When editing, propagates the changes made to all
    <span class="tooltip-important-text">Dialogs</span> with the same
    <strong>Speaker Name & Speaker Portrait</strong> value.
</ng-template>